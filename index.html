<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>Valentines ¬∑ a love story</title>
    <!-- soft, romantic font -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght=400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ------------------------------------------------------
           DREAM VALENTINE'S COSMOS ‚Äî FULLY RESPONSIVE
           ------------------------------------------------------ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --blush-petal: #ffe9f0;
            --rose-silk: #ffd1dc;
            --cherry: #ff4d6d;
            --deep-crimson: #c9184a;
            --velvet: #800f2f;
            --champagne-mist: rgba(255, 250, 240, 0.7);
            --golden-hour: #ffb347;
            --shadow-pink: rgba(201, 24, 74, 0.25);
            --glass-edge: rgba(255, 255, 255, 0.8);
            
            /* responsive spacing */
            --card-padding-desktop: 2.8rem 2.2rem;
            --card-padding-tablet: 2.2rem 1.8rem;
            --card-padding-mobile: 1.8rem 1.2rem;
            --font-size-h1-desktop: 2.8rem;
            --font-size-h1-tablet: 2.4rem;
            --font-size-h1-mobile: 1.9rem;
        }

        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: radial-gradient(circle at 10% 30%, #ffe5ec, #ffc9d9);
            font-family: 'Quicksand', 'Segoe UI', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
            transition: background 1s ease;
        }

        body.celebration-mode {
            background: radial-gradient(circle at 80% 20%, #ffdee5, #ffb6c1);
        }

        /* ---- floating canvas for advanced confetti ---- */
        #glitterCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
        }

        /* ---------- main valentine card (fully responsive) ---------- */
        .love-letter {
            background: rgba(255, 245, 245, 0.55);
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            border-radius: clamp(24px, 56px, 64px) clamp(16px, 24px, 32px) clamp(24px, 56px, 64px) clamp(16px, 24px, 32px);
            border: 2px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 25px 45px var(--shadow-pink), 0 5px 15px rgba(255, 140, 174, 0.3);
            padding: var(--card-padding-desktop);
            max-width: min(650px, 95%);
            width: 92%;
            margin: 1rem auto;
            position: relative;
            z-index: 100;
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1.2);
            border: 2px solid rgba(255, 220, 240, 0.9);
        }

        /* tablet adjustments */
        @media screen and (max-width: 768px) {
            .love-letter {
                padding: var(--card-padding-tablet);
                width: 94%;
                border-radius: 40px 20px 40px 20px;
            }
        }

        /* mobile adjustments */
        @media screen and (max-width: 480px) {
            .love-letter {
                padding: var(--card-padding-mobile);
                width: 96%;
                border-radius: 32px 16px 32px 16px;
                margin: 0.6rem auto;
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
            }
        }

        .love-letter:hover {
            box-shadow: 0 35px 60px rgba(201, 24, 74, 0.3);
            transform: scale(1.01);
        }

        /* ----- switching scenes ----- */
        .scene {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            transition: opacity 0.6s ease, transform 0.5s ease;
        }

        .scene-hidden {
            display: none !important;
            opacity: 0;
            transform: scale(0.96);
        }

        /* ----- MAIN QUESTION STYLE (responsive) ----- */
        .proposal-scene h1 {
            font-size: clamp(1.9rem, 8vw, 2.8rem);
            font-weight: 700;
            background: linear-gradient(145deg, var(--deep-crimson), var(--cherry));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.6rem;
            text-shadow: 0 8px 20px rgba(255, 77, 109, 0.35);
            letter-spacing: -0.01em;
            line-height: 1.2;
            text-align: center;
            word-break: break-word;
        }

        .cute-tagline {
            background: rgba(255, 255, 245, 0.7);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
            padding: 0.6rem 1.8rem;
            border-radius: 60px;
            color: #9d1f3c;
            font-size: clamp(1rem, 4vw, 1.2rem);
            font-weight: 600;
            border: 2px solid white;
            margin-bottom: 1.8rem;
            display: inline-block;
            text-align: center;
            max-width: 100%;
            word-break: break-word;
        }

        @media screen and (max-width: 480px) {
            .cute-tagline {
                padding: 0.5rem 1rem;
                font-size: 0.95rem;
                line-height: 1.4;
            }
        }

        /* ----- BUTTON COUPLE (fully responsive) ----- */
        .button-duo {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: clamp(1rem, 4vw, 1.8rem);
            margin: clamp(1.5rem, 5vw, 2.2rem) 0 0.8rem;
            width: 100%;
        }

        .btn {
            border: none;
            padding: clamp(0.8rem, 3vw, 1rem) clamp(1.5rem, 6vw, 2.6rem);
            font-size: clamp(1.1rem, 5vw, 1.5rem);
            font-weight: 700;
            border-radius: 200px;
            background: white;
            box-shadow: 0 10px 0 rgba(0, 0, 0, 0.02), 0 14px 28px var(--shadow-pink);
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: all 0.22s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.6rem;
            border: 3px solid transparent;
            font-family: 'Quicksand', sans-serif;
            flex: 0 1 auto;
            min-width: min(160px, 40vw);
            white-space: nowrap;
        }

        @media screen and (max-width: 380px) {
            .btn {
                white-space: normal;
                min-width: 140px;
                padding: 0.7rem 1rem;
            }
        }

        .btn-yes {
            background: linear-gradient(125deg, #ff4d6d, #d62828);
            color: white;
            text-shadow: 0 2px 5px rgba(80, 0, 20, 0.2);
            border: 3px solid #ffe6ec;
        }

        .btn-yes:hover {
            transform: scale(1.14) translateY(-6px);
            background: linear-gradient(125deg, #ff5e7c, #c9184a);
            box-shadow: 0 20px 35px #ff8cae;
        }

        .btn-no {
            background: rgba(255, 245, 240, 0.85);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            color: #4a3b3f;
            border: 3px solid rgba(255, 255, 255, 0.9);
            font-weight: 600;
        }

        .btn-no:hover {
            background: #fff9fb;
            box-shadow: 0 10px 0 #ffd9e2;
        }

        /* runaway state responsive */
        .btn-no.runaway-style {
            transition: left 0.12s ease, top 0.12s ease, opacity 0.2s;
            box-shadow: 0 14px 0 #ffb3c6, 0 20px 35px rgba(201, 24, 74, 0.3);
            opacity: 0.95;
            z-index: 999;
            position: fixed !important;
            width: auto;
            min-width: 120px;
        }

        @media screen and (max-width: 480px) {
            .btn-no.runaway-style {
                min-width: 100px;
                padding: 0.6rem 1.2rem;
                font-size: 1rem;
            }
        }

        /* ---------- ACCEPTANCE SCENE ‚Äî FULLY RESPONSIVE ---------- */
        .celebration-scene {
            text-align: center;
            width: 100%;
        }

        .celebrate-headline {
            font-size: clamp(1.6rem, 7vw, 2.5rem);
            font-weight: 700;
            color: var(--deep-crimson);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1.2rem;
            line-height: 1.3;
            word-break: break-word;
        }

        .invitation-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: clamp(32px, 48px, 56px);
            padding: clamp(1.2rem, 5vw, 2rem) clamp(1rem, 4vw, 1.8rem);
            margin: 1.5rem 0;
            border: 3px solid white;
            box-shadow: inset 0 0 0 3px rgba(255, 255, 255, 0.7);
            width: 100%;
        }

        .hotel-name {
            font-size: clamp(1.3rem, 6vw, 2.1rem);
            font-weight: 800;
            color: #a4133c;
            letter-spacing: -0.5px;
            line-height: 1.3;
            word-break: break-word;
            display: block;
        }

        .golden-hour-badge {
            background: var(--cherry);
            color: white;
            padding: 0.5rem clamp(1rem, 5vw, 2rem);
            border-radius: 100px;
            display: inline-block;
            font-weight: 800;
            font-size: clamp(1.1rem, 5vw, 1.5rem);
            margin: 1rem 0 0.5rem;
            box-shadow: 0 8px 0 #7f1d3b;
            border: 2px solid #ffe6ec;
            max-width: 100%;
            word-break: break-word;
        }

        .secret-portal {
            display: inline-block;
            margin-top: 1.3rem;
            font-size: clamp(1.3rem, 6vw, 2rem);
            color: var(--deep-crimson);
            text-decoration: none;
            background: rgba(255, 255, 255, 0.7);
            padding: 0.5rem clamp(1.2rem, 5vw, 2rem);
            border-radius: 120px;
            transition: all 0.35s;
            border: 3px dashed #ff4d6d;
            font-weight: 700;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            word-break: break-word;
            max-width: 100%;
        }

        .secret-portal:hover {
            background: white;
            transform: scale(1.1);
            border: 3px solid var(--deep-crimson);
            letter-spacing: 4px;
        }

        /* ----- FLOATING EMOJI BALLOONS (responsive) ----- */
        .floatie {
            position: fixed;
            bottom: -30px;
            z-index: 20;
            pointer-events: none;
            animation: levitate 8s linear forwards;
            font-size: clamp(1.8rem, 6vw, 2.4rem);
            filter: drop-shadow(0 10px 15px rgba(255, 100, 130, 0.3));
            user-select: none;
            white-space: nowrap;
        }

        @keyframes levitate {
            0% { transform: translateY(0) rotate(0deg); opacity: 0.9; }
            100% { transform: translateY(-120vh) rotate(20deg); opacity: 0.1; }
        }

        /* ripple on click */
        .ripple-spark {
            position: fixed;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.9) 0%, rgba(255,200,220,0.4) 70%);
            transform: scale(0);
            animation: rippleFlow 0.8s ease-out;
            pointer-events: none;
            z-index: 9999;
        }

        @keyframes rippleFlow {
            to { transform: scale(18); opacity: 0; }
        }

        /* additional pulse (responsive) */
        .pulse-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            border: 2px solid rgba(255, 255, 255, 0.5);
            animation: softPulse 3s infinite;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        @keyframes softPulse {
            0% { transform: scale(1); opacity: 0.5; }
            70% { transform: scale(1.05); opacity: 0; }
            100% { transform: scale(1); opacity: 0; }
        }

        /* disable no button after yes */
        .btn-no:disabled {
            opacity: 0.5;
            filter: grayscale(0.6);
            transform: none !important;
            pointer-events: none;
            box-shadow: 0 5px 0 #e6c3c3;
        }

        /* extra love tag (responsive) */
        .floating-signature {
            position: fixed;
            bottom: clamp(10px, 3vh, 15px);
            right: clamp(15px, 4vw, 20px);
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            opacity: 0.35;
            z-index: 200;
            pointer-events: none;
            rotate: 5deg;
            white-space: nowrap;
        }

        @media screen and (max-width: 480px) {
            .floating-signature {
                bottom: 8px;
                right: 12px;
                font-size: 1.1rem;
            }
        }

        /* decorative corner hearts (responsive) */
        .corner-deco {
            position: fixed;
            font-size: clamp(1.5rem, 6vw, 2.2rem);
            opacity: 0.3;
            z-index: 200;
            pointer-events: none;
        }

        /* responsive text helpers */
        .text-responsive {
            word-break: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
        }

        /* mobile-specific adjustments */
        @media screen and (max-width: 360px) {
            .button-duo {
                flex-direction: column;
                gap: 1rem;
            }
            
            .btn {
                width: 100%;
                max-width: 200px;
            }
            
            .celebrate-headline {
                flex-direction: column;
            }
            
            .hotel-name {
                font-size: 1.2rem;
            }
        }

        /* landscape orientation */
        @media screen and (max-height: 600px) and (orientation: landscape) {
            .love-letter {
                padding: 1.2rem;
                margin: 0.5rem auto;
            }
            
            .proposal-scene h1 {
                font-size: 1.8rem;
                margin-bottom: 0.3rem;
            }
            
            .button-duo {
                margin: 0.8rem 0;
            }
            
            .btn {
                padding: 0.5rem 1.2rem;
                font-size: 1rem;
            }
            
            .floating-signature {
                bottom: 5px;
                right: 10px;
            }
        }

        /* high-resolution displays */
        @media screen and (min-width: 1400px) {
            .love-letter {
                max-width: 750px;
                padding: 3rem 2.5rem;
            }
            
            .proposal-scene h1 {
                font-size: 3.2rem;
            }
        }

        /* touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                padding: 0.9rem 1.8rem;
                min-height: 52px;
            }
            
            .btn:hover {
                transform: none;
            }
            
            .btn-no.runaway-style {
                transition: left 0.2s ease, top 0.2s ease;
            }
            
            .secret-portal {
                padding: 0.8rem 1.5rem;
            }
        }

        /* dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --champagne-mist: rgba(40, 20, 30, 0.7);
            }
            
            body {
                background: radial-gradient(circle at 10% 30%, #331f26, #2a1a1f);
            }
            
            .love-letter {
                background: rgba(30, 20, 25, 0.65);
                border-color: rgba(255, 200, 210, 0.3);
            }
            
            .cute-tagline {
                background: rgba(40, 25, 30, 0.8);
                color: #ffb3c6;
                border-color: #ff99aa;
            }
        }

        /* print styles */
        @media print {
            .love-letter {
                box-shadow: none;
                border: 1px solid #000;
                background: white;
            }
            
            .btn, .secret-portal, .floatie, #glitterCanvas {
                display: none;
            }
        }

        /* utility classes */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body id="mainBody">

    <!-- AUDIO ELEMENT -->
    <audio id="bgMusic" preload="auto" loop>
        <source src="audio/love.mp3" type="audio/mpeg">
    </audio>

    <!-- high-performance confetti canvas -->
    <canvas id="glitterCanvas"></canvas>

    <!-- MAIN CARD -->
    <div class="love-letter" role="main" aria-label="Valentine's Day love letter">
        <div class="pulse-glow" aria-hidden="true"></div>

        <!-- SCENE 1: The question -->
        <div id="sceneQuestion" class="scene proposal-scene">
            <h1>üå∏ will you be <br>my Valentine? üå∏</h1>
            <span class="cute-tagline">‚ú¶ the cutest yes or the sweetest chase ‚ú¶</span>
            <div class="button-duo">
                <button id="yesLoveBtn" class="btn btn-yes" aria-label="Yes, I'll be your Valentine"><span aria-hidden="true">‚ù§Ô∏è</span> Yes!</button>
                <button id="noRunBtn" class="btn btn-no" aria-label="No (this button runs away)">ü•∫ No</button>
            </div>
            <p style="margin-top: clamp(1rem, 4vw, 2rem); color: #b34167; font-weight: 600; opacity: 0.9; font-size: clamp(0.8rem, 3vw, 1rem);">
                ( the "no" button is shy ‚Äî try to catch it! )
            </p>
        </div>

        <!-- SCENE 2: THE ACCEPTANCE / GRAND REVEAL -->
        <div id="sceneCelebrate" class="scene celebration-scene scene-hidden">
            <div class="celebrate-headline">
                <span aria-hidden="true">ü•∞</span>sabi ko na nga ba! <br> Love na love mo ko!<span aria-hidden="true">ü•∞</span>
            </div>
            <div class="invitation-card">
                <div style="font-size: clamp(1.8rem, 8vw, 2.4rem); margin-bottom: 0.3rem;" aria-hidden="true">üíå</div>
                <span class="hotel-name">Happy Valentines Mahal ko‚ù§Ô∏è<br></span>
                <span class="hotel-name">I LOVE YOU SO MUCH‚ù§Ô∏è</span>
                <a href="flowers.html" class="secret-portal" aria-label="Click for a surprise!">
                    ‚ù§Ô∏è click me! ‚ù§Ô∏è
                </a>
            </div>
            <div style="display: flex; gap: 0.8rem; justify-content: center; font-size: clamp(1.5rem, 7vw, 2.2rem); margin-top: 0.3rem; flex-wrap: wrap;" aria-hidden="true">
                <span>üçì</span> <span>üç∞</span> <span>‚ú®</span> <span>üåπ</span>
            </div>
        </div>
    </div>

    <!-- floating signature -->
    <div class="floating-signature" aria-hidden="true">üíó forever yours</div>
    
    <!-- decorative corners (responsive) -->
    <div class="corner-deco" style="top: clamp(12px, 4vh, 16px); left: clamp(12px, 4vw, 18px);" aria-hidden="true">üíó</div>
    <div class="corner-deco" style="bottom: clamp(12px, 4vh, 18px); left: clamp(12px, 4vw, 18px);" aria-hidden="true">üå∏</div>
    <div class="corner-deco" style="top: clamp(12px, 4vh, 18px); right: clamp(16px, 5vw, 22px); rotate: 10deg;" aria-hidden="true">‚ú®</div>

    <script>
        (function(){
            "use strict";
            // -----------------------------------------------------------
            // FULLY RESPONSIVE VALENTINE'S INTERACTIVE EXPERIENCE
            // -----------------------------------------------------------
            
            // DOM elements
            const yesBtn = document.getElementById('yesLoveBtn');
            const noBtn = document.getElementById('noRunBtn');
            const sceneQ = document.getElementById('sceneQuestion');
            const sceneC = document.getElementById('sceneCelebrate');
            const mainCard = document.querySelector('.love-letter');
            const magicLink = document.getElementById('magicHeartLink');
            const bodyEl = document.getElementById('mainBody');
            const canvas = document.getElementById('glitterCanvas');
            const audio = document.getElementById('bgMusic');
            let ctx = canvas.getContext('2d');

            // state flags
            let noBtnAbsolute = false;
            let runawayActive = true;
            let confettiMode = false;
            let particlesArray = [];
            let isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

            // --- resize canvas (responsive) ---
            function resizeGlitterCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeGlitterCanvas);
            resizeGlitterCanvas();

            // --- FLOATING BACKGROUND EMOJIS (responsive interval) ---
            function spawnFloatie() {
                const emojiBank = ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíñ', 'üíò', 'üíù', 'üéà', 'üå∏', 'üå∫', 'üçì', '‚ú®', 'üíï', 'üíû', 'üåπ', 'ü•Ä', 'üç∞'];
                const floatEl = document.createElement('div');
                floatEl.className = 'floatie';
                floatEl.textContent = emojiBank[Math.floor(Math.random() * emojiBank.length)];
                floatEl.style.left = Math.random() * 100 + '%';
                floatEl.style.animationDuration = (Math.random() * 7 + 6) + 's';
                
                // responsive font size
                const baseSize = window.innerWidth < 480 ? 20 : 24;
                floatEl.style.fontSize = (Math.random() * 30 + baseSize) + 'px';
                floatEl.style.opacity = Math.random() * 0.55 + 0.4;
                
                document.body.appendChild(floatEl);
                setTimeout(() => { floatEl.remove(); }, 13000);
            }
            
            // adjust spawn rate based on screen size
            let floatieInterval = setInterval(spawnFloatie, window.innerWidth < 480 ? 300 : 240);
            
            window.addEventListener('resize', function() {
                clearInterval(floatieInterval);
                floatieInterval = setInterval(spawnFloatie, window.innerWidth < 480 ? 300 : 240);
            });

            // --- ULTRA-RUNAWAY NO BUTTON (responsive bounds) ---
            function evadeCursor() {
                if (!noBtn || !runawayActive) return;

                if (!noBtnAbsolute) {
                    noBtn.style.position = 'fixed';
                    noBtn.classList.add('runaway-style');
                    noBtnAbsolute = true;
                }

                const btnRect = noBtn.getBoundingClientRect();
                
                // responsive boundaries
                const padding = window.innerWidth < 480 ? 8 : 15;
                const minX = padding;
                const maxX = window.innerWidth - btnRect.width - padding;
                const minY = padding;
                const maxY = window.innerHeight - btnRect.height - padding;

                let newX = Math.random() * (maxX - minX) + minX;
                let newY = Math.random() * (maxY - minY) + minY;

                // more random movement on larger screens
                if (window.innerWidth > 768 && Math.random() < 0.3) {
                    newX += (Math.random() - 0.5) * 110;
                    newY += (Math.random() - 0.5) * 90;
                }

                // clamp values
                newX = Math.min(maxX, Math.max(minX, newX));
                newY = Math.min(maxY, Math.max(minY, newY));

                noBtn.style.left = `${newX}px`;
                noBtn.style.top = `${newY}px`;
                noBtn.style.transition = 'left 0.13s ease, top 0.13s ease';
            }

            // touch event for mobile
            if (isTouchDevice) {
                noBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    if (runawayActive) {
                        evadeCursor();
                        createMiniHeart(e.touches[0].clientX, e.touches[0].clientY);
                    }
                });
            }

            noBtn.addEventListener('mouseover', function(e) {
                if (runawayActive && !isTouchDevice) {
                    evadeCursor();
                    createMiniHeart(e.clientX, e.clientY);
                }
            });

            function createMiniHeart(x, y) {
                const heartSpan = document.createElement('span');
                heartSpan.textContent = '‚ù§Ô∏è';
                heartSpan.style.position = 'fixed';
                heartSpan.style.left = x + 'px';
                heartSpan.style.top = y + 'px';
                heartSpan.style.fontSize = window.innerWidth < 480 ? '1.5rem' : '2rem';
                heartSpan.style.pointerEvents = 'none';
                heartSpan.style.zIndex = '99999';
                heartSpan.style.animation = 'levitate 1.3s ease-out forwards';
                heartSpan.style.opacity = '0.9';
                document.body.appendChild(heartSpan);
                setTimeout(() => heartSpan.remove(), 1300);
            }

            // --- YES BUTTON ---
            yesBtn.addEventListener('click', function(e) {
                sceneQ.classList.add('scene-hidden');
                sceneC.classList.remove('scene-hidden');
                
                runawayActive = false;
                noBtn.disabled = true;
                noBtn.innerHTML = window.innerWidth < 480 ? 'ü•∞ yes!' : 'ü•∞ yes!';
                noBtn.style.cursor = 'default';

                if (noBtnAbsolute) {
                    noBtn.style.left = window.innerWidth < 480 ? 'calc(70% - 40px)' : 'calc(80% - 40px)';
                    noBtn.style.top = window.innerHeight - 130 + 'px';
                    noBtn.style.position = 'fixed';
                }

                bodyEl.classList.add('celebration-mode');
                startConfettiBlizzard();
                createRippleWave(e.clientX, e.clientY);
                
                for (let i=0; i<12; i++) setTimeout(() => { spawnFloatie(); }, i*30);
            });

            function createRippleWave(x, y) {
                const rippleDiv = document.createElement('div');
                rippleDiv.className = 'ripple-spark';
                rippleDiv.style.left = x + 'px';
                rippleDiv.style.top = y + 'px';
                rippleDiv.style.width = window.innerWidth < 480 ? '20px' : '30px';
                rippleDiv.style.height = window.innerWidth < 480 ? '20px' : '30px';
                document.body.appendChild(rippleDiv);
                setTimeout(() => rippleDiv.remove(), 900);
            }

            // --- CONFETTI PARTICLE SYSTEM (optimized) ---
            function startConfettiBlizzard() {
                confettiMode = true;
                const particleCount = window.innerWidth < 480 ? 100 : 180;
                
                for (let i=0; i<particleCount; i++) {
                    particlesArray.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height * 0.3 + canvas.height * 0.3,
                        size: Math.random() * (window.innerWidth < 480 ? 10 : 14) + 5,
                        color: `hsl(${Math.random() * 20 + 340}, 85%, 68%)`,
                        speedX: (Math.random() - 0.5) * 5,
                        speedY: Math.random() * -9 - 3,
                        life: Math.random() * 80 + 50
                    });
                }
                
                if (!window.confettiLoop) {
                    window.confettiLoop = requestAnimationFrame(drawConfettiGlitter);
                }
            }

            function drawConfettiGlitter() {
                if (!ctx) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let alive = false;
                
                for (let i=particlesArray.length-1; i>=0; i--) {
                    const p = particlesArray[i];
                    ctx.globalAlpha = Math.min(1, p.life / 70);
                    ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size * 0.5, 0, Math.PI * 2);
                    ctx.fill();
                    
                    p.x += p.speedX;
                    p.y += p.speedY;
                    p.speedY += 0.13;
                    p.speedX *= 0.99;
                    p.life -= 1.2;

                    if (p.life <= 0 || p.y > canvas.height + 30) {
                        particlesArray.splice(i, 1);
                    } else {
                        alive = true;
                    }
                }
                
                if (alive || particlesArray.length > 0) {
                    window.confettiLoop = requestAnimationFrame(drawConfettiGlitter);
                } else {
                    confettiMode = false;
                    cancelAnimationFrame(window.confettiLoop);
                    window.confettiLoop = null;
                }
            }

            // --- MAGIC LINK (play audio + open link) ---
            if (magicLink) {
                magicLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // play audio
                    audio.volume = 0.5;
                    audio.play().catch(error => {
                        console.log('Auto-play blocked, trying again...');
                        setTimeout(() => {
                            audio.play();
                        }, 100);
                    });
                    
                    // heart shower (responsive count)
                    const heartCount = window.innerWidth < 480 ? 24 : 36;
                    
                    for (let i=0; i<heartCount; i++) {
                        setTimeout(() => {
                            const heartEm = document.createElement('div');
                            heartEm.textContent = '‚ù§Ô∏è';
                            heartEm.style.position = 'fixed';
                            heartEm.style.left = Math.random() * 100 + '%';
                            heartEm.style.top = Math.random() * 100 + '%';
                            heartEm.style.fontSize = (Math.random() * (window.innerWidth < 480 ? 30 : 44) + 24) + 'px';
                            heartEm.style.animation = 'levitate 2.2s ease forwards';
                            heartEm.style.pointerEvents = 'none';
                            heartEm.style.zIndex = '9999';
                            document.body.appendChild(heartEm);
                            setTimeout(() => heartEm.remove(), 2200);
                        }, i * 18);
                    }
                    
                    // open link
                    setTimeout(() => {
                        window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ', '_blank');
                    }, 150);
                });
            }

            // --- NO BUTTON CLICK ---
            noBtn.addEventListener('click', function(e) {
                if (runawayActive) {
                    e.preventDefault();
                    e.stopPropagation();
                    alert('ü•∫ nice try! but my heart already knows your answer.');
                    evadeCursor();
                }
            });

            // --- RESIZE HANDLER (keep runaway button in bounds) ---
            window.addEventListener('resize', function() {
                if (noBtnAbsolute && runawayActive && noBtn.style.left) {
                    const btnRect = noBtn.getBoundingClientRect();
                    const padding = window.innerWidth < 480 ? 8 : 15;
                    
                    let currentLeft = parseFloat(noBtn.style.left) || padding;
                    let currentTop = parseFloat(noBtn.style.top) || padding;
                    
                    currentLeft = Math.min(window.innerWidth - btnRect.width - padding, Math.max(padding, currentLeft));
                    currentTop = Math.min(window.innerHeight - btnRect.height - padding, Math.max(padding, currentTop));
                    
                    noBtn.style.left = `${currentLeft}px`;
                    noBtn.style.top = `${currentTop}px`;
                }
                
                // resize canvas
                resizeGlitterCanvas();
            });

            // --- subtle mousemove sparkle (reduced on mobile) ---
            window.addEventListener('mousemove', function(e) {
                if (!isTouchDevice && Math.random() < 0.02) {
                    createMiniHeart(e.clientX, e.clientY);
                }
            });

            // --- initial load ---
            window.addEventListener('load', function() {
                // initial floaties
                for (let i=0; i< (window.innerWidth < 480 ? 4 : 6); i++) {
                    setTimeout(spawnFloatie, i*70);
                }
                
                resizeGlitterCanvas();
                
                // audio setup
                audio.volume = 0.5;
                audio.load();
            });

            // --- extra love: heart cascade on card click ---
            mainCard.addEventListener('click', function(e) {
                if (e.target === magicLink || e.target === yesBtn) return;
                if (Math.random() < 0.3) createMiniHeart(e.clientX, e.clientY);
            });

            // --- cleanup on page hide ---
            window.addEventListener('beforeunload', function() {
                if (floatieInterval) clearInterval(floatieInterval);
                if (window.confettiLoop) cancelAnimationFrame(window.confettiLoop);
            });

        })();
    </script>

    <!-- tiny patch to ensure hidden class works -->
    <style>
        .scene-hidden {
            display: none !important;
        }
        #sceneCelebrate {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .btn-no:disabled {
            background: #ffe2e2;
            color: #6b4b4b;
            border: 3px solid #ffc2c2;
            opacity: 0.7;
        }
        .secret-portal {
            cursor: pointer;
        }
        body.celebration-mode .love-letter {
            border: 3px solid white;
        }
        
        /* fix for iOS Safari */
        @supports (-webkit-touch-callout: none) {
            .love-letter {
                background: rgba(255, 245, 245, 0.75);
            }
            
            .btn, .secret-portal {
                -webkit-appearance: none;
            }
        }
    </style>
</body>
</html>